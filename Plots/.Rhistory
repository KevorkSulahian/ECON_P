library(stringr)
library(utf8)
library(ggplot2)
library(shiny)
library(shinyjs)
library(shinydashboard)
library(rsconnect)
runApp(
list(
ui = dashboardPage(
dashboardHeader(),
dashboardSidebar( fileInput('file1', 'Choose xlsx file',
accept = c(".xlsx")),
selectInput('Exp_imp','Export or Import',
choices = c("Export","Import"))),
dashboardBody(
# fluidRow(
# tags$hr(),
plotOutput("graph")
# )
))
,
server = shinyServer(function(input, output) {
my_data <- reactive({
inFile <- input$file1
if (is.null(inFile))
return(NULL)
df  <- readxl::read_xlsx(inFile1$datapath, sheet = 1, col_names = TRUE) #Reading the file
colnames(df) <-c("Name", "Price","Growth")
df$Price <- as.numeric(df$Price)
df$Growth <- as.numeric(df$Growth)
df <- df[!(df$Price<0),]
df$Price <- as.numeric(df$Price)
df<-df[order(df$Price),]
df$Price <- round(df$Price, 1)
df$Name <- trimws(df$Name)
df$Name <-as.factor(df$Name)
df$Name <- factor(df$Name,levels= df$Name)
df$Growth <- as.numeric(df$Growth)
df$Price <- round(as.numeric(df$Price),1)
return(df)
})
# output$contents <- renderTable({
#
#   my_data()
# })
output$graph <- renderPlot({
inFile <- input$file1
if (is.null(inFile))
return(NULL)
df <- my_data()
if (input$Exp_imp == "Export"){
ggplot(df,aes(x=df$Name))  +
geom_bar(aes(y=df$Price),stat="identity", fill='#042900',alpha=1) +
geom_bar(aes(y=(df$Price - df$Growth)),stat="identity", fill="#03561C",alpha=0.5 ,
size=ifelse(df$Growth<0,1,0)) +
geom_text(aes(label=ifelse(df$Growth<0,paste0(Price," (↓)"),paste0(Price," (↑)")),
y=ifelse(df$Growth<0, Price-Growth, Price)),hjust= -0.5, color= ifelse(df$Growth<0,"Red","DarkGreen"), size=5,fontface="bold")+
scale_y_continuous(breaks = seq(0,max(df$Price)+50,50), limits = c(0, max(df$Price)+50))+
theme_minimal() +
theme(
plot.title = element_blank(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
axis.text.y = element_text(size=18,face="bold"),
axis.text.x = element_text(size=12,face="bold"))  +
coord_flip()
}
else {
ggplot(df,aes(x=df$Name))  +
geom_bar(aes(y=df$Price),stat="identity", fill='#186866',alpha=1) +
geom_bar(aes(y=(df$Price - df$Growth)),stat="identity", fill="#16D1CC",alpha=0.25 ,
size=ifelse(df$Growth<0,1,0)) +
geom_text(aes(label=ifelse(df$Growth<0,paste0(Price," (↓)"),paste0(Price," (↑)")),
y=ifelse(df$Growth<0, Price-Growth, Price)),hjust= -0.5, color= ifelse(df$Growth<0,"Red","#186866"), size=5,fontface = "bold")+
scale_y_continuous(breaks = seq(0,max(df$Price)+50,50), limits = c(0, max(df$Price)+50))+
theme_minimal() +
theme(
plot.title = element_blank(),
axis.title.x = element_blank(),
axis.title.y = element_blank(),
axis.text.y = element_text(size=18,face="bold"),
axis.text.x = element_text(size=12,face="bold"))  +
coord_flip()
}
})
})
))
